{% extends "base.html" %}
{% block nav_browse %}active{% endblock %}

{% block head %}
<style>
/* ==========================================================================
   Tag / Category Page â€” Wikipedia-style listing
   Clean, centered, no sidebar, no animations
   ========================================================================== */

/* --- Hide sidebar, center content --- */
.ct-sidebar { display: none !important; }
.ct-main {
  max-width: var(--content-width) !important;
  margin: 0 auto;
}

/* --- Breadcrumb --- */
.tag-breadcrumb {
  font-family: var(--font-body);
  font-size: 0.82rem;
  color: var(--light-text-dim);
  margin-bottom: 1rem;
}

.tag-breadcrumb a {
  color: var(--accent);
  text-decoration: none;
}

.tag-breadcrumb a:visited { color: var(--accent); }
.tag-breadcrumb a:hover { text-decoration: underline; }

.tag-breadcrumb .sep {
  margin: 0 0.4rem;
  color: var(--light-text-dim);
}

/* --- Title --- */
.tag-title {
  font-family: var(--font-display);
  font-size: 2.25rem;
  font-weight: 700;
  color: var(--light-text);
  margin: 0 0 0.5rem;
  padding-bottom: 0.6rem;
  border-bottom: 1px solid var(--light-border);
  line-height: 1.2;
  letter-spacing: -0.02em;
}

/* --- Description --- */
.tag-description {
  font-family: var(--font-body);
  font-size: 0.95rem;
  color: var(--light-text-muted);
  line-height: 1.6;
  margin-bottom: 1.5rem;
}

/* --- Trace list --- */
.trace-item {
  display: block;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--light-border-faint);
}

.trace-item:last-child {
  border-bottom: none;
}

.trace-item:hover {
  background: var(--light-surface-hover);
}

.trace-item-title {
  display: block;
  font-family: var(--font-body);
  font-size: 1rem;
  font-weight: 500;
  color: var(--accent);
  text-decoration: none;
  margin-bottom: 0.2rem;
  line-height: 1.4;
}

.trace-item-title:visited { color: var(--violet); }
.trace-item-title:hover { text-decoration: underline; }

.trace-item-excerpt {
  font-family: var(--font-body);
  font-size: 0.88rem;
  color: var(--light-text-muted);
  line-height: 1.55;
  margin: 0 0 0.35rem;
  display: -webkit-box;
  -webkit-line-clamp: 1;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.trace-item-tags {
  font-size: 0.78rem;
  color: var(--light-text-dim);
}

.trace-item-tags a {
  color: var(--light-text-dim);
  text-decoration: none;
}

.trace-item-tags a:visited { color: var(--light-text-dim); }
.trace-item-tags a:hover { color: var(--accent); text-decoration: underline; }

.trace-item-tags .trace-item-tag--current {
  color: var(--accent);
  font-weight: 600;
}

/* --- Empty state --- */
.tag-empty {
  padding: 3rem 0;
  text-align: center;
  color: var(--light-text-dim);
  font-size: 0.95rem;
}

/* --- Back link --- */
.tag-back {
  margin: 1.5rem 0 2rem;
}

.tag-back a {
  font-size: 0.9rem;
  color: var(--accent);
  text-decoration: none;
}

.tag-back a:visited { color: var(--accent); }
.tag-back a:hover { text-decoration: underline; }

/* --- Responsive --- */
@media (max-width: 640px) {
  .tag-title {
    font-size: 1.6rem;
  }

  .trace-item-title {
    font-size: 0.95rem;
  }
}
</style>
{% endblock %}

{% block content %}

<!-- Breadcrumb -->
<nav class="tag-breadcrumb" aria-label="Breadcrumb">
  <a href="{{ url('/') }}">CommonTrace</a>
  <span class="sep">&rsaquo;</span>
  <a href="{{ url('/browse/') }}">{{ t('tag.breadcrumb_categories') }}</a>
  <span class="sep">&rsaquo;</span>
  {{ tag }}
</nav>

<!-- Title -->
<h1 class="tag-title">{{ tag }}</h1>

<!-- Description -->
<p class="tag-description">
  {% if traces|length == 1 %}
    {{ t('tag.description_singular', tag=tag) }}
  {% else %}
    {{ t('tag.description_plural', count=traces|length, tag=tag) }}
  {% endif %}
</p>

{% if traces %}
<!-- Trace list -->
<div>
  {% for trace in traces %}
  <article class="trace-item">
    <a href="{{ url('/trace/' + trace.slug + '/') }}" class="trace-item-title">{{ trace.title }}</a>
    <p class="trace-item-excerpt">{{ trace.context[:200] }}{% if trace.context|length > 200 %}...{% endif %}</p>
    <div class="trace-item-tags">
      {% for t in trace.tags %}{% if not loop.first %}, {% endif %}<a href="{{ url('/tag/' + t + '/') }}" class="{% if t == tag %}trace-item-tag--current{% endif %}">{{ t }}</a>{% endfor %}
    </div>
  </article>
  {% endfor %}
</div>
{% else %}
<!-- Empty state -->
<div class="tag-empty">{{ t('tag.empty') }}</div>
{% endif %}

<!-- Back link -->
<div class="tag-back">
  <a href="{{ url('/browse/') }}">&larr; {{ t('tag.back') }}</a>
</div>

{% endblock %}
